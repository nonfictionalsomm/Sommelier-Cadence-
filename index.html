<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Sommelier's Cadence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --primary-color: #c5b358; /* Gold */
            --dark-grey: #2c2c2c;
            --light-grey: #444444;
            --correct-color: #4CAF50;
            --incorrect-color: #D32F2F;
            --font-serif: 'Cormorant Garamond', serif;
            --font-sans: 'Lato', sans-serif;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-size: 16px;
        }

        .game-container {
            width: 100%;
            max-width: 600px;
            background-color: var(--dark-grey);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .screen {
            padding: 30px 40px;
            text-align: center;
            display: none; /* Hidden by default */
        }

        .screen.active {
            display: block;
        }
        
        #start-screen h1 {
            font-family: var(--font-serif);
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        #start-screen p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .btn {
            background-color: var(--primary-color);
            color: var(--bg-color);
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(197, 179, 88, 0.3);
        }

        #game-screen {
            position: relative;
        }

        .progress-bar-container {
            width: 100%;
            background-color: var(--light-grey);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 10px;
            background-color: var(--primary-color);
            transition: width 0.3s ease-in-out;
        }
        
        #question-category {
            font-family: var(--font-serif);
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        #question-text {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 30px;
            min-height: 50px;
        }

        .answer-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .answer-btn {
            background-color: var(--light-grey);
            color: var(--text-color);
            border: 2px solid var(--light-grey);
            padding: 15px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            min-height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .answer-btn:hover {
            border-color: var(--primary-color);
        }
        
        .answer-btn.correct {
            background-color: var(--correct-color);
            border-color: var(--correct-color);
            color: white;
        }

        .answer-btn.incorrect {
            background-color: var(--incorrect-color);
            border-color: var(--incorrect-color);
            color: white;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        #score-display {
            position: absolute;
            top: 25px;
            right: 40px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        #end-screen h2 {
            font-family: var(--font-serif);
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        #final-score {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        #correct-wine-info {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        #correct-wine-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }
        
        #correct-wine-region {
            font-size: 1.1rem;
            margin: 5px 0 0 0;
        }
        
        @media (max-width: 500px) {
            body {
                padding: 10px;
            }
            .screen {
                padding: 20px;
            }
             #start-screen h1 {
                font-size: 2.5rem;
             }
             .answer-options {
                grid-template-columns: 1fr;
             }
             #score-display {
                 position: static;
                 margin-bottom: 15px;
             }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div id="start-screen" class="screen active">
            <h1>The Sommelier's Cadence</h1>
            <p>Welcome to your virtual tasting room. A classic wine has been poured. Follow the deductive tasting grid to identify it. Your speed and accuracy are key. Good luck.</p>
            <button id="start-btn" class="btn">Begin Tasting</button>
        </div>
        <div id="game-screen" class="screen">
            <div id="score-display">Score: 0</div>
            <div class="progress-bar-container"><div class="progress-bar"></div></div>
            <h2 id="question-category">Sight</h2>
            <p id="question-text">What is the wine's intensity of color?</p>
            <div id="answer-options-container" class="answer-options"></div>
        </div>
        <div id="end-screen" class="screen">
            <h2>Tasting Complete</h2>
            <p id="final-score">Your Final Score: 18/20</p>
            <div id="correct-wine-info">
                <p style="margin-top:0; font-weight:bold;">The wine was:</p>
                <h3 id="correct-wine-name">Chardonnay</h3>
                <p id="correct-wine-region">Napa Valley, USA</p>
            </div>
            <button id="play-again-btn" class="btn">Taste Another Wine</button>
        </div>
    </div>

    <script>
        // --- PARADIGM DATABASE --- //
        const paradigms = [
            { name: "Chardonnay, Chablis Premier Cru", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Straw", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "No New Oak" }, palate: { Sweetness: "Bone Dry", Acidity: "High", Alcohol: "Medium", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Chardonnay", finalCountry: "France", finalRegion: "Chablis Premier Cru" } },
            { name: "Chardonnay, Côte de Beaune", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Straw", Tearing: "Medium Plus" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Ripe", Oak: "Medium New Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium Plus", Alcohol: "Medium Plus", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Chardonnay", finalCountry: "France", finalRegion: "Côte de Beaune" } },
            { name: "Chardonnay, Napa Valley", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Medium to Deep", "Primary Color": "Gold", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Baked", Oak: "High New Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium", Alcohol: "Medium Plus to High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Chardonnay", finalCountry: "USA", finalRegion: "Napa Valley" } },
            { name: "Sauvignon Blanc, Sancerre", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Straw", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "No New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", Alcohol: "Medium", Body: "Medium", "Length of Finish": "Medium Plus", Complexity: "Medium Plus" }, conclusion: { finalGrape: "Sauvignon Blanc", finalCountry: "France", finalRegion: "Sancerre" } },
            { name: "Sauvignon Blanc, Marlborough", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Straw", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Ripe", Oak: "No New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", Alcohol: "Medium", Body: "Medium", "Length of Finish": "Medium Plus", Complexity: "Medium Plus" }, conclusion: { finalGrape: "Sauvignon Blanc", finalCountry: "New Zealand", finalRegion: "Marlborough" } },
            { name: "Riesling, Clare Valley", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Water White", "Primary Color": "Straw", Tearing: "Light" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "No New Oak" }, palate: { Sweetness: "Bone Dry", Acidity: "High", Alcohol: "Low to Medium Minus", Body: "Light", "Length of Finish": "Medium Plus", Complexity: "Medium Plus" }, conclusion: { finalGrape: "Riesling", finalCountry: "Australia", finalRegion: "Clare Valley" } },
            { name: "Riesling, Kabinett", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Straw", Tearing: "Light" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart to Just-Ripe", Oak: "No New Oak" }, palate: { Sweetness: "Off-Dry", Acidity: "High", Alcohol: "Low", Body: "Light", "Length of Finish": "Medium Plus", Complexity: "Medium Plus" }, conclusion: { finalGrape: "Riesling", finalCountry: "Germany", finalRegion: "Mosel (Kabinett)" } },
            { name: "Chenin Blanc, Savennières", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Yellow", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "Neutral Oak" }, palate: { Sweetness: "Bone Dry", Acidity: "High", Alcohol: "Medium to Medium Plus", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Chenin Blanc", finalCountry: "France", finalRegion: "Savennières" } },
            { name: "Pinot Gris, Alsace Grand Cru", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Gold", Tearing: "Medium Plus" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Ripe", Oak: "Neutral Oak" }, palate: { Sweetness: "Off-Dry", Acidity: "Medium", Alcohol: "Medium Plus", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Pinot Gris", finalCountry: "France", finalRegion: "Alsace Grand Cru" } },
            { name: "Grüner Veltliner, Smaragd", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Straw", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "No New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", Alcohol: "Medium Plus", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Grüner Veltliner", finalCountry: "Austria", finalRegion: "Wachau (Smaragd)" } },
            { name: "Albariño, Rías Baixas", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Straw", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "No New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", Alcohol: "Medium", Body: "Medium", "Length of Finish": "Medium Plus", Complexity: "Medium Plus" }, conclusion: { finalGrape: "Albariño", finalCountry: "Spain", finalRegion: "Rías Baixas" } },
            { name: "Viognier, Condrieu", type: "White", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Gold", Tearing: "Medium Plus" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Ripe", Oak: "Neutral Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium", Alcohol: "Medium Plus to High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Viognier", finalCountry: "France", finalRegion: "Condrieu" } },
            { name: "Pinot Noir, Côte de Nuits", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Ruby", "Rim Variation": "Yes", Staining: "Light", Tearing: "Medium Plus" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Developing", "Fruit Condition": "Tart", Oak: "Medium New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", "Tannin Volume": "Medium", "Tannin Texture": "Silky", Alcohol: "Medium Plus", Body: "Medium", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Pinot Noir", finalCountry: "France", finalRegion: "Côte de Nuits" } },
            { name: "Pinot Noir, Sonoma Coast", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Ruby", "Rim Variation": "No", Staining: "Medium", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Ripe", Oak: "High New Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium Plus", "Tannin Volume": "Medium Plus", "Tannin Texture": "Soft", Alcohol: "High", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Pinot Noir", finalCountry: "USA", finalRegion: "Sonoma Coast" } },
            { name: "Cabernet Sauvignon, Left Bank Bordeaux", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Deep", "Primary Color": "Ruby", "Rim Variation": "Yes", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Developing", "Fruit Condition": "Tart", Oak: "High New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", "Tannin Volume": "High", "Tannin Texture": "Gritty", Alcohol: "Medium Plus", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Cabernet Sauvignon Blend", finalCountry: "France", finalRegion: "Left Bank Bordeaux" } },
            { name: "Cabernet Sauvignon, Napa Valley", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Deep to Opaque", "Primary Color": "Purple", "Rim Variation": "No", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Ripe", Oak: "High New Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium Plus", "Tannin Volume": "High", "Tannin Texture": "Coarse", Alcohol: "High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Cabernet Sauvignon", finalCountry: "USA", finalRegion: "Napa Valley" } },
            { name: "Syrah, Northern Rhône", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Deep", "Primary Color": "Purple", "Rim Variation": "No", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "Medium New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", "Tannin Volume": "High", "Tannin Texture": "Gritty", Alcohol: "Medium Plus", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Syrah", finalCountry: "France", finalRegion: "Northern Rhône" } },
            { name: "Shiraz, Barossa Valley", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Opaque", "Primary Color": "Purple", "Rim Variation": "No", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Jammy", Oak: "High New Oak (American)" }, palate: { Sweetness: "Dry", Acidity: "Medium", "Tannin Volume": "High", "Tannin Texture": "Soft", Alcohol: "High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Shiraz", finalCountry: "Australia", finalRegion: "Barossa Valley" } },
            { name: "Grenache, Southern Rhône", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Garnet", "Rim Variation": "Yes", Staining: "Medium", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Developing", "Fruit Condition": "Dried/Desiccated", Oak: "Neutral Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium", "Tannin Volume": "Medium Plus", "Tannin Texture": "Gritty", Alcohol: "High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Grenache Blend", finalCountry: "France", finalRegion: "Southern Rhône" } },
            { name: "Sangiovese, Chianti Classico Riserva", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Garnet", "Rim Variation": "Yes", Staining: "Medium", Tearing: "Medium Plus" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Developing", "Fruit Condition": "Tart", Oak: "Neutral Oak" }, palate: { Sweetness: "Dry", Acidity: "High", "Tannin Volume": "High", "Tannin Texture": "Gritty", Alcohol: "Medium Plus", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Sangiovese", finalCountry: "Italy", finalRegion: "Chianti Classico Riserva" } },
            { name: "Nebbiolo, Barolo", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Pale", "Primary Color": "Garnet", "Rim Variation": "Yes", Staining: "Medium", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Developing", "Fruit Condition": "Tart", Oak: "Neutral Oak" }, palate: { Sweetness: "Dry", Acidity: "High", "Tannin Volume": "High", "Tannin Texture": "Coarse", Alcohol: "High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Nebbiolo", finalCountry: "Italy", finalRegion: "Barolo" } },
            { name: "Tempranillo, Rioja Gran Reserva", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Medium", "Primary Color": "Garnet", "Rim Variation": "Yes", Staining: "Medium", Tearing: "Medium Plus" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Vinous (aged)", "Fruit Condition": "Dried/Desiccated", Oak: "High New Oak (American)" }, palate: { Sweetness: "Dry", Acidity: "Medium Plus", "Tannin Volume": "Medium Plus", "Tannin Texture": "Soft", Alcohol: "Medium Plus", Body: "Medium Plus", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Tempranillo", finalCountry: "Spain", finalRegion: "Rioja Gran Reserva" } },
            { name: "Gamay, Morgon", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Medium Minus", "Primary Color": "Ruby", "Rim Variation": "No", Staining: "Medium", Tearing: "Medium" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Youthful", "Fruit Condition": "Tart", Oak: "No New Oak" }, palate: { Sweetness: "Dry", Acidity: "High", "Tannin Volume": "Low", "Tannin Texture": "Silky", Alcohol: "Medium", Body: "Medium Minus", "Length of Finish": "Medium", Complexity: "Medium" }, conclusion: { finalGrape: "Gamay", finalCountry: "France", finalRegion: "Morgon" } },
            { name: "Merlot, Right Bank Bordeaux", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Deep", "Primary Color": "Ruby", "Rim Variation": "Yes", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Medium Plus", "Age Assessment": "Developing", "Fruit Condition": "Ripe", Oak: "High New Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium Plus", "Tannin Volume": "High", "Tannin Texture": "Soft", Alcohol: "Medium Plus", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Merlot Blend", finalCountry: "France", finalRegion: "Right Bank Bordeaux" } },
            { name: "Zinfandel, Napa Valley", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Deep", "Primary Color": "Ruby", "Rim Variation": "No", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Youthful", "Fruit Condition": "Jammy", Oak: "High New Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium", "Tannin Volume": "Medium Plus", "Tannin Texture": "Soft", Alcohol: "Very High", Body: "Full", "Length of Finish": "Long", Complexity: "High" }, conclusion: { finalGrape: "Zinfandel", finalCountry: "USA", finalRegion: "Napa Valley" } },
            { name: "Corvina Blend, Amarone della Valpolicella", type: "Red", sight: { "Clarity": "Clear", "Intensity of Color": "Deep", "Primary Color": "Garnet", "Rim Variation": "Yes", Staining: "Heavy", Tearing: "Heavy" }, nose: { "Aromatic Intensity": "Powerful", "Age Assessment": "Developing", "Fruit Condition": "Dried/Desiccated", Oak: "Neutral Oak" }, palate: { Sweetness: "Dry", Acidity: "Medium Plus to High", "Tannin Volume": "High", "Tannin Texture": "Chewy", Alcohol: "High to Very High", Body: "Full", "Length of Finish": "Very Long", Complexity: "High" }, conclusion: { finalGrape: "Corvina Blend", finalCountry: "Italy", finalRegion: "Amarone della Valpolicella" } }
        ];

        // --- STATIC GRID OPTIONS (THE FIX!) --- //
        const gridOptions = {
            "Clarity": ["Clear", "Hazy", "Cloudy"],
            "Intensity of Color": ["Water White", "Pale", "Medium", "Deep", "Opaque", "Medium to Deep", "Medium Minus"],
            "Primary Color": ["Straw", "Yellow", "Gold", "Purple", "Ruby", "Garnet"],
            "Tearing": ["Light", "Medium", "Medium Plus", "Heavy"],
            "Rim Variation": ["Yes", "No"],
            "Staining": ["None", "Light", "Medium", "Heavy"],
            "Aromatic Intensity": ["Delicate", "Medium", "Medium Plus", "Powerful"],
            "Age Assessment": ["Youthful", "Developing", "Vinous (aged)"],
            "Fruit Condition": ["Tart", "Ripe", "Baked", "Jammy", "Dried/Desiccated", "Tart to Just-Ripe"],
            "Oak": ["No New Oak", "Neutral Oak", "Medium New Oak", "High New Oak", "High New Oak (American)"],
            "Sweetness": ["Bone Dry", "Dry", "Off-Dry"],
            "Acidity": ["Low", "Medium", "Medium Plus", "High", "Medium Plus to High"],
            "Alcohol": ["Low", "Medium Minus", "Medium", "Medium Plus", "High", "Very High", "Low to Medium Minus", "Medium to Medium Plus", "Medium Plus to High", "High to Very High"],
            "Body": ["Light", "Medium Minus", "Medium", "Medium Plus", "Full"],
            "Tannin Volume": ["Low", "Medium", "Medium Plus", "High"],
            "Tannin Texture": ["Silky", "Soft", "Gritty", "Coarse", "Chewy"],
            "Length of Finish": ["Short", "Medium", "Medium Plus", "Long", "Very Long"],
            "Complexity": ["Simple", "Medium", "Medium Plus", "High"],
            "Final Grape": paradigms.map(p => p.conclusion.finalGrape),
            "Final Region": paradigms.map(p => p.conclusion.finalRegion)
        };

        // --- GAME LOGIC --- //
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startBtn = document.getElementById('start-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const progressBar = document.querySelector('.progress-bar');
        const questionCategoryEl = document.getElementById('question-category');
        const questionTextEl = document.getElementById('question-text');
        const answerOptionsContainer = document.getElementById('answer-options-container');
        const scoreDisplay = document.getElementById('score-display');
        const finalScoreEl = document.getElementById('final-score');
        const correctWineNameEl = document.getElementById('correct-wine-name');
        const correctWineRegionEl = document.getElementById('correct-wine-region');

        let currentParadigm = {};
        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;

        const questionOrder = [
            { category: 'Sight', key: 'Clarity' }, { category: 'Sight', key: 'Intensity of Color' }, { category: 'Sight', key: 'Primary Color' }, { category: 'Sight', key: 'Tearing' },
            { category: 'Sight', key: 'Rim Variation', type: 'Red' }, { category: 'Sight', key: 'Staining', type: 'Red' },
            { category: 'Nose', key: 'Aromatic Intensity' }, { category: 'Nose', key: 'Age Assessment' }, { category: 'Nose', key: 'Fruit Condition' }, { category: 'Nose', key: 'Oak' },
            { category: 'Palate', key: 'Sweetness' }, { category: 'Palate', key: 'Acidity' }, { category: 'Palate', key: 'Alcohol' }, { category: 'Palate', key: 'Body' },
            { category: 'Palate', key: 'Tannin Volume', type: 'Red' }, { category: 'Palate', key: 'Tannin Texture', type: 'Red' },
            { category: 'Palate', key: 'Length of Finish' }, { category: 'Palate', key: 'Complexity' },
            { category: 'Conclusion', key: 'Final Grape' }, { category: 'Conclusion', key: 'Final Region' },
        ];
        
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function getNestedValue(obj, cat, key) {
            if (cat === 'Conclusion') {
                const accessKey = key.charAt(0).toLowerCase() + key.slice(1).replace(/\s/g, '');
                return obj.conclusion[accessKey];
            }
            return obj[cat.toLowerCase()][key];
        }
        
        function getDistractors(correctAnswer, questionKey, count) {
            const optionsPool = Array.from(new Set(gridOptions[questionKey]));
            const distractors = optionsPool.filter(opt => opt !== correctAnswer);
            return shuffle(distractors).slice(0, count);
        }

        function generateQuestionsForParadigm(paradigm) {
            const generatedQuestions = [];
            const relevantQuestions = questionOrder.filter(q => !q.type || q.type === paradigm.type);

            relevantQuestions.forEach(qInfo => {
                const correctAnswer = getNestedValue(paradigm, qInfo.category, qInfo.key);
                if (correctAnswer === undefined) return;

                const distractors = getDistractors(correctAnswer, qInfo.key, 3);
                let options = [correctAnswer, ...distractors];
                
                // Ensure there are always 4 unique options if possible
                if (options.length < 4) {
                    const allPossible = Array.from(new Set(gridOptions[qInfo.key]));
                    const remainingOptions = allPossible.filter(opt => !options.includes(opt));
                    options.push(...shuffle(remainingOptions).slice(0, 4 - options.length));
                }

                // If still not enough, duplicate options (last resort)
                while (options.length > 0 && options.length < 4) {
                    options.push(options[0]);
                }
                
                generatedQuestions.push({
                    category: qInfo.category,
                    text: qInfo.key === 'Final Grape' ? 'What is the Grape Variety?' : (qInfo.key === 'Final Region' ? 'What is the Region?' : `What is the wine's ${qInfo.key}?`),
                    correctAnswer: correctAnswer,
                    options: shuffle(options.slice(0, 4))
                });
            });
            return generatedQuestions;
        }

        function startGame() {
            currentParadigm = paradigms[Math.floor(Math.random() * paradigms.length)];
            questions = generateQuestionsForParadigm(currentParadigm);
            currentQuestionIndex = 0;
            score = 0;
            updateScoreDisplay();
            startScreen.classList.remove('active');
            endScreen.classList.remove('active');
            gameScreen.classList.add('active');
            displayNextQuestion();
        }

        function displayNextQuestion() {
            if (currentQuestionIndex >= questions.length) {
                endGame();
                return;
            }
            const question = questions[currentQuestionIndex];
            questionCategoryEl.textContent = question.category;
            questionTextEl.textContent = question.text;
            answerOptionsContainer.innerHTML = '';
            question.options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add('answer-btn');
                button.addEventListener('click', () => selectAnswer(button, option));
                answerOptionsContainer.appendChild(button);
            });
            updateProgressBar();
        }

        function selectAnswer(button, selectedOption) {
            const question = questions[currentQuestionIndex];
            const buttons = answerOptionsContainer.querySelectorAll('.answer-btn');
            buttons.forEach(btn => btn.disabled = true);
            if (selectedOption === question.correctAnswer) {
                button.classList.add('correct');
                score++;
                updateScoreDisplay();
            } else {
                button.classList.add('incorrect');
                buttons.forEach(btn => {
                    if (btn.textContent === question.correctAnswer) {
                        btn.classList.add('correct');
                    }
                });
            }
            setTimeout(() => {
                currentQuestionIndex++;
                displayNextQuestion();
            }, 1500);
        }
        
        function updateProgressBar() {
            const progress = (currentQuestionIndex / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `Score: ${score}`;
        }
        
        function endGame() {
            gameScreen.classList.remove('active');
            endScreen.classList.add('active');
            finalScoreEl.textContent = `Your Final Score: ${score} / ${questions.length}`;
            correctWineNameEl.textContent = currentParadigm.conclusion.finalGrape;
            correctWineRegionEl.textContent = `${currentParadigm.conclusion.finalRegion}, ${currentParadigm.conclusion.finalCountry}`;
        }

        startBtn.addEventListener('click', startGame);
        playAgainBtn.addEventListener('click', startGame);
    </script>
</body>
</html>


